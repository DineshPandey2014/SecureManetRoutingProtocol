var PORT = 44444;
var HOST = '127.0.0.1';
var crypto = require("crypto")
var dgram = require('dgram');
var server = dgram.createSocket('udp4');
var crypto = require("crypto")

console.log("I am here for UDP");


server.on('listening', function () {
    var address = server.address();
    console.log('UDP Server listening on ' + address.address + ":" + address.port);
});


server.on('message', function (message, remote) {
    var key = "p6L32vnOhCn+Re/n3F+4";
    var decryptedText = decrypt(key, message);
    console.log(remote.address + ':' + remote.port +' - ' + decryptedText);
    //socket.setBroadcast

});

server.bind(PORT, HOST)

function decrypt(key, data) {
    var decipher = crypto.createDecipher('aes-256-cbc', key);
    decipher.setAutoPadding(auto_padding=false);
    var dcryptedBuffers = [decipher.update(new Buffer(data))];
    dcryptedBuffers.push(decipher.final());
    var dcrypted = Buffer.concat(dcryptedBuffers)
        .toString('utf8');
    return dcrypted;
    /*
    var decrypted = decipher.update(data, 'hex', 'utf-8');
    console.log("------Dinesh----"+decrypted);
    decrypted += decipher.final('utf-8');
    return decrypted;*/
}

